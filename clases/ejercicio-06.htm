<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ejercicios con Clases en Javascript Ejercicio 6</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <a href="../clases.html" class="btn-volver">‚Üê Volver al √≠ndice</a>

        <h1>Ejercicio 6 BilleteraVirtual</h1>
        <p>
          Crear las siguientes clases con sus respectivos m√©todos y propiedades.
          Usar propiedades privadas. Cuando se devuelvan valores, si son objetos
          y arrays de las propiedades, devolver copias de los mismo, para evitar
          que puedan ser modificados.
        </p>
        <p style="color: var(--secondary-color); margin-top: 0.5rem">
          - **Propiedades** <br />
          - monto <br />
          - operaciones (array de objetos), inicializa vac√≠o <br />
          - **Constructor** <br />
          - toma como argumento `montoInicial` y lo asigna a `monto` <br />
          - **M√©todos** <br />
          - **`agregarGasto(gasto)`** agrega `gasto` a operaciones <br />
          - **`agregarGanancia(ganancia)`** agrega `ganancia` a operaciones
          <br />
          - **`obtenerGastosPorMes(mes)`** devuelve un array con todos los
          gastos hechos en `mes` <br />
          - **`obtenerGanaciasPorMes(mes)`** devuelve un array con todas los
          ganancias obtenidas en `mes` <br />
          - **`obtenerGastosPorCategoria(categoria)`** devuelve un array con
          todos los gastos de cierta `categoria` <br />
          - **`obtenerGanaciasPorCategoria(categoria)`** devuelve un array con
          todas las ganancias de cierta `categoria` <br />
          - **`calcularTotalPorMes(mes)`** devuelve el total resultante de
          restar todos los gastos hechos y sumar todas las ganancias obtenidas
          en un cierto `mes` <br />
          - **`calcularTotalPorCategoria(categoria)`** devuelve el total
          resultante de restar todos los gastos hechos y sumar todas las
          ganancias obtenidas en cierta `categoria <br />
          - **`obtenerMonto()**` devuelve `monto` <br />
          - **Observaciones** <br />
          - los objetos `gasto` y `ganancia` contiene las propiedades: <br />
          - `descripcion` (string) <br />
          - `cantidad` (n√∫mero) <br />
          - `fecha` (Date) <br />
          - `categoria` (string) <br />
          - cuando se agrega `gasto` o `ganancia` al array operaciones, hay que
          agregarle a dicha objeto la propiedad `tipo` con el valor `"GASTO"` o
          `"GANANCIA"` seg√∫n corresponda, para poder identificarlos en las
          siguientes operaciones <br />
          - cuando se devuelve un array con gastos o ganancias, hay que borrar
          de los objetos que se devuelven la propiedad `tipo` <br />
        </p>
      </header>

      <main>
        <button type="button" class="btn-refresh" onclick="location.reload()">
          <span class="icon">‚Üª</span> Actualizar P√°gina
        </button>
      </main>
    </div>
    <script src="./js/script.js"></script>
    <script>
      // --- CLASE BILLETERA VIRTUAL ---
      class BilleteraVirtual {
        #monto;
        #operaciones = [];

        constructor(montoInicial) {
          this.#monto = Number(montoInicial) || 0;
        }

        #registrarOperacion(datos, tipo) {
          const nuevaOperacion = {
            ...datos,
            tipo: tipo,
            fecha: new Date(), // Usamos la fecha actual para simplificar al usuario
          };
          this.#operaciones.push(nuevaOperacion);
          this.#monto =
            tipo === "GASTO"
              ? this.#monto - datos.cantidad
              : this.#monto + datos.cantidad;
        }

        agregarGasto(gasto) {
          this.#registrarOperacion(gasto, "GASTO");
        }
        agregarGanancia(ganancia) {
          this.#registrarOperacion(ganancia, "GANANCIA");
        }

        #filtrarYLimpiar(tipo, criterioFn) {
          return this.#operaciones
            .filter((op) => op.tipo === tipo && criterioFn(op))
            .map((op) => {
              const { tipo, ...copiaSinTipo } = op;
              return { ...copiaSinTipo };
            });
        }

        obtenerGastosPorMes(mes) {
          return this.#filtrarYLimpiar(
            "GASTO",
            (op) => op.fecha.getMonth() === mes
          );
        }
        obtenerGanaciasPorMes(mes) {
          return this.#filtrarYLimpiar(
            "GANANCIA",
            (op) => op.fecha.getMonth() === mes
          );
        }

        obtenerMonto() {
          return this.#monto;
        }

        listarTodo() {
          if (this.#operaciones.length === 0) return "No hay movimientos.";
          return this.#operaciones
            .map(
              (op) =>
                `[${op.tipo}] ${op.descripcion}: $${op.cantidad} (${op.categoria})`
            )
            .join("\n");
        }
      }

      // --- L√ìGICA DE INTERFAZ (PROMPT / ALERT) ---

      const montoInicial = parseFloat(
        prompt("üí∞ Bienvenido. Introduce tu saldo inicial:")
      );
      const miBilletera = new BilleteraVirtual(montoInicial);

      let ejecutando = true;

      while (ejecutando) {
        const menu =
          `üíµ SALDO ACTUAL: $${miBilletera.obtenerMonto()}\n\n` +
          `1. Registrar GASTO\n` +
          `2. Registrar GANANCIA\n` +
          `3. Ver Historial Completo\n` +
          `4. Ver Gastos del Mes Actual\n` +
          `5. Salir`;

        const opcion = prompt(menu);

        try {
          switch (opcion) {
            case "1":
            case "2":
              const desc = prompt("Descripci√≥n del movimiento:");
              const cant = parseFloat(prompt("Cantidad ($):"));
              const cat = prompt("Categor√≠a (ej: Comida, Sueldo, Ocio):");

              if (isNaN(cant))
                throw new Error("La cantidad debe ser un n√∫mero.");

              const datos = {
                descripcion: desc,
                cantidad: cant,
                categoria: cat,
                fecha: new Date(),
              };

              if (opcion === "1") {
                miBilletera.agregarGasto(datos);
                alert("üö´ Gasto registrado.");
              } else {
                miBilletera.agregarGanancia(datos);
                alert("‚úÖ Ganancia registrada.");
              }
              break;

            case "3":
              alert(
                "üìù HISTORIAL DE MOVIMIENTOS:\n" + miBilletera.listarTodo()
              );
              break;

            case "4":
              const mesActual = new Date().getMonth(); // 0-11
              const gastosMes = miBilletera.obtenerGastosPorMes(mesActual);

              if (gastosMes.length === 0) {
                alert("No hay gastos registrados en este mes.");
              } else {
                const lista = gastosMes
                  .map((g) => `- ${g.descripcion}: $${g.cantidad}`)
                  .join("\n");
                alert(`üìâ GASTOS DEL MES:\n${lista}`);
              }
              break;

            case "5":
            case null:
              ejecutando = false;
              alert("Cerrando billetera. ¬°Cuida tu dinero!");
              break;

            default:
              alert("Opci√≥n no v√°lida.");
          }
        } catch (e) {
          alert("‚ö†Ô∏è Error: " + e.message);
        }
      }
    </script>
  </body>
</html>
